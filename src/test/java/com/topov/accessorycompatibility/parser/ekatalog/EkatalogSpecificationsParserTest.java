package com.topov.accessorycompatibility.parser.ekatalog;

import com.topov.accessorycompatibility.parser.SpecificationsParser;
import org.jsoup.Jsoup;
import org.jsoup.nodes.Document;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;

import java.util.Map;
import java.util.Optional;
import java.util.concurrent.CompletableFuture;

import static org.junit.jupiter.api.Assertions.*;

@SpringBootTest
class EkatalogSpecificationsParserTest {
    private final SpecificationsParser specificationsParser;

    @Autowired
    EkatalogSpecificationsParserTest(SpecificationsParser specificationsParser) {
        this.specificationsParser = specificationsParser;
    }

    @Test
    public void parseProcessorSpecifications() {
        Document doc = Jsoup.parse("<td class=\"op01\" width=\"48%\"><table width=\"100%\" cellspacing=\"0\" cellpadding=\"3\" border=\"0\"><tbody><tr><td><span class=\"op1-title\">Основное</span></td></tr><tr valign=\"top\"><td class=\"op1\" width=\"49%\"><span class=\"gloss\" jtype=\"click\" jsource=\"https://ek.ua/mtools/mui_gloss.php?idGloss_=23860\" jid=\"p23860\" jsub=\"Y\">Комплектуется <span class=\"nobr ib\">кулером</span></span></td><td class=\"op3\" width=\"51%\"><img src=\"/img/icons/bul_141.gif\" alt=\"\" width=\"8\" height=\"10\" border=\"0\"> <span class=\"oth\">/&nbsp;Wraith Stealth&nbsp;/</span></td></tr><tr valign=\"top\"><td class=\"op1\" width=\"49%\"><span class=\"gloss\" jtype=\"click\" jsource=\"https://ek.ua/mtools/mui_gloss.php?idGloss_=7500\" jid=\"p7500\" jsub=\"Y\"><span class=\"nobr ib\">Серия</span></span></td><td class=\"op3\" width=\"51%\">Ryzen 5</td></tr><tr valign=\"top\"><td class=\"op1\" width=\"49%\"><span class=\"gloss\" jtype=\"click\" jsource=\"https://ek.ua/mtools/mui_gloss.php?idGloss_=7489\" jid=\"p7489\" jsub=\"Y\">Кодовое <span class=\"nobr ib\">название</span></span></td><td class=\"op3\" width=\"51%\">Matisse (Zen 2)</td></tr><tr valign=\"top\"><td class=\"op1\" width=\"49%\"><span class=\"gloss\" jtype=\"click\" jsource=\"https://ek.ua/mtools/mui_gloss.php?idGloss_=7478\" jid=\"p7478\" jsub=\"Y\">Разъем <span class=\"nobr ib\">(Socket)</span></span></td><td class=\"op3\" width=\"51%\"><a href=\"/ek-list.php?katalog_=187&amp;idgm_=1485970\">AMD AM4</a></td></tr><tr valign=\"top\"><td class=\"op1\" width=\"49%\"><span class=\"gloss\" jtype=\"click\" jsource=\"https://ek.ua/mtools/mui_gloss.php?idGloss_=7480\" jid=\"p7480\" jsub=\"Y\">Кол-во <span class=\"nobr ib\">ядер</span></span></td><td class=\"op3\" width=\"51%\">6&nbsp;cores</td></tr><tr valign=\"top\"><td class=\"op1\" width=\"49%\"><span class=\"gloss\" jtype=\"click\" jsource=\"https://ek.ua/mtools/mui_gloss.php?idGloss_=24534\" jid=\"p24534\" jsub=\"Y\">Кол-во <span class=\"nobr ib\">потоков</span></span></td><td class=\"op3\" width=\"51%\">12&nbsp;threads</td></tr><tr valign=\"top\"><td class=\"op1\" width=\"49%\"><span class=\"gloss\" jtype=\"click\" jsource=\"https://ek.ua/mtools/mui_gloss.php?idGloss_=21507\" jid=\"p21507\" jsub=\"Y\">SMT <span class=\"nobr ib\">(многопоточность)</span></span></td><td class=\"op3\" width=\"51%\"><img src=\"/img/icons/bul_141.gif\" alt=\"\" width=\"8\" height=\"10\" border=\"0\"></td></tr><tr valign=\"top\"><td class=\"op1\" width=\"49%\"><span class=\"gloss\" jtype=\"click\" jsource=\"https://ek.ua/mtools/mui_gloss.php?idGloss_=7479\" jid=\"p7479\" jsub=\"Y\">Тактовая <span class=\"nobr ib\">частота</span></span></td><td class=\"op3\" width=\"51%\">3.6&nbsp;ГГц</td></tr><tr valign=\"top\"><td class=\"op1\" width=\"49%\"><span class=\"gloss\" jtype=\"click\" jsource=\"https://ek.ua/mtools/mui_gloss.php?idGloss_=18973\" jid=\"p18973\" jsub=\"Y\">Частота TurboBoost / <span class=\"nobr ib\">TurboCore</span></span></td><td class=\"op3\" width=\"51%\">4.2&nbsp;ГГц</td></tr><tr valign=\"top\"><td class=\"op1\" width=\"49%\"><span class=\"gloss\" jtype=\"click\" jsource=\"https://ek.ua/mtools/mui_gloss.php?idGloss_=7483\" jid=\"p7483\" jsub=\"Y\"><span class=\"nobr ib\">Техпроцесс</span></span></td><td class=\"op3\" width=\"51%\">7&nbsp;нм</td></tr><tr valign=\"top\"><td class=\"op1\" width=\"49%\"><span class=\"gloss\" jtype=\"click\" jsource=\"https://ek.ua/mtools/mui_gloss.php?idGloss_=24733\" jid=\"p24733\" jsub=\"Y\">Тест Passmark CPU <span class=\"nobr ib\">Mark</span></span></td><td class=\"op3\" width=\"51%\">19975</td></tr></tbody></table></td><td class=\"op02\" width=\"52%\"><table width=\"100%\" cellspacing=\"0\" cellpadding=\"3\" border=\"0\"><tbody><tr valign=\"top\"><td class=\"op1\" width=\"49%\"><span class=\"gloss\" jtype=\"click\" jsource=\"https://ek.ua/mtools/mui_gloss.php?idGloss_=18966\" jid=\"p18966\" jsub=\"Y\">Модель <span class=\"nobr ib\">IGP</span></span></td><td class=\"op3\" width=\"51%\">отсутствует</td></tr><tr data-no-mobile=\"\"><td colspan=\"2\"><img src=\"/img/p.gif\" alt=\"\" width=\"1\" height=\"1\" border=\"0\"></td></tr><tr data-no-mobile=\"\"><td colspan=\"2\" class=\"line11\"><img src=\"/img/p.gif\" alt=\"\" width=\"1\" height=\"1\" border=\"0\"></td></tr><tr valign=\"top\"><td colspan=\"2\" class=\"op1\"><span class=\"op1-title\"><span class=\"cmp-gr-name\">Объемы кэш памяти</span></span></td></tr><tr valign=\"top\"><td class=\"op1\" width=\"49%\"><span class=\"gloss\" jtype=\"click\" jsource=\"https://ek.ua/mtools/mui_gloss.php?idGloss_=7486\" jid=\"p7486\" jsub=\"Y\">2-го уровня <span class=\"nobr ib\">L2</span></span></td><td class=\"op3\" width=\"51%\">3072&nbsp;КБ</td></tr><tr valign=\"top\"><td class=\"op1\" width=\"49%\"><span class=\"gloss\" jtype=\"click\" jsource=\"https://ek.ua/mtools/mui_gloss.php?idGloss_=22368\" jid=\"p22368\" jsub=\"Y\">3-го уровня <span class=\"nobr ib\">L3</span></span></td><td class=\"op3\" width=\"51%\">32&nbsp;МБ</td></tr><tr data-no-mobile=\"\"><td colspan=\"2\"><img src=\"/img/p.gif\" alt=\"\" width=\"1\" height=\"1\" border=\"0\"></td></tr><tr data-no-mobile=\"\"><td colspan=\"2\" class=\"line11\"><img src=\"/img/p.gif\" alt=\"\" width=\"1\" height=\"1\" border=\"0\"></td></tr><tr valign=\"top\"><td colspan=\"2\" class=\"op1\"><span class=\"op1-title\"><span class=\"cmp-gr-name\">Характеристики</span></span></td></tr><tr valign=\"top\"><td class=\"op1\" width=\"49%\"><span class=\"gloss\" jtype=\"click\" jsource=\"https://ek.ua/mtools/mui_gloss.php?idGloss_=7492\" jid=\"p7492\" jsub=\"Y\">Тепловыделение <span class=\"nobr ib\">(TDP)</span></span></td><td class=\"op3\" width=\"51%\">65&nbsp;Вт</td></tr><tr valign=\"top\"><td class=\"op1\" width=\"49%\"><span class=\"gloss\" jtype=\"click\" jsource=\"https://ek.ua/mtools/mui_gloss.php?idGloss_=7494\" jid=\"p7494\" jsub=\"Y\">Поддержка <span class=\"nobr ib\">инструкций</span></span></td><td class=\"op3\" width=\"51%\">MMX+, SSE, SSE2, SSE3, SSSE3, SSE4.1, SSE4.2, SSE4A, AMD-V, AES, AVX <span class=\"oth\">/&nbsp;AVX2, FMA3, SHA&nbsp;/</span></td></tr><tr valign=\"top\"><td class=\"op1\" width=\"49%\"><span class=\"gloss\" jtype=\"click\" jsource=\"https://ek.ua/mtools/mui_gloss.php?idGloss_=7499\" jid=\"p7499\" jsub=\"Y\"><span class=\"nobr ib\">Множитель</span></span></td><td class=\"op3\" width=\"51%\">36</td></tr><tr valign=\"top\"><td class=\"op1\" width=\"49%\"><span class=\"gloss\" jtype=\"click\" jsource=\"https://ek.ua/mtools/mui_gloss.php?idGloss_=7504\" jid=\"p7504\" jsub=\"Y\">Свободный <span class=\"nobr ib\">множитель</span></span></td><td class=\"op3\" width=\"51%\"><img src=\"/img/icons/bul_141.gif\" alt=\"\" width=\"8\" height=\"10\" border=\"0\"></td></tr><tr data-no-mobile=\"\"><td colspan=\"2\"><img src=\"/img/p.gif\" alt=\"\" width=\"1\" height=\"1\" border=\"0\"></td></tr><tr data-no-mobile=\"\"><td colspan=\"2\" class=\"line11\"><img src=\"/img/p.gif\" alt=\"\" width=\"1\" height=\"1\" border=\"0\"></td></tr><tr valign=\"top\"><td colspan=\"2\" class=\"op1\"><span class=\"op1-title\"><span class=\"cmp-gr-name\">Поддержка памяти</span></span></td></tr><tr valign=\"top\"><td class=\"op1\" width=\"49%\"><span class=\"gloss\" jtype=\"click\" jsource=\"https://ek.ua/mtools/mui_gloss.php?idGloss_=18967\" jid=\"p18967\" jsub=\"Y\">Макс. <span class=\"nobr ib\">объем</span></span></td><td class=\"op3\" width=\"51%\">128&nbsp;ГБ</td></tr><tr valign=\"top\"><td class=\"op1\" width=\"49%\"><span class=\"gloss\" jtype=\"click\" jsource=\"https://ek.ua/mtools/mui_gloss.php?idGloss_=18969\" jid=\"p18969\" jsub=\"Y\">Макс. частота <span class=\"nobr ib\">DDR4</span></span></td><td class=\"op3\" width=\"51%\">3200&nbsp;МГц</td></tr><tr valign=\"top\"><td class=\"op1\" width=\"49%\"><span class=\"gloss\" jtype=\"click\" jsource=\"https://ek.ua/mtools/mui_gloss.php?idGloss_=18970\" jid=\"p18970\" jsub=\"Y\">Число <span class=\"nobr ib\">каналов</span></span></td><td class=\"op3\" width=\"51%\">2&nbsp;шт</td></tr><tr valign=\"top\"><td class=\"op1\" width=\"49%\"><span><span class=\"cmp-gr-name\">Официальный сайт</span></span></td><td class=\"op3\" width=\"51%\"><a href=\"#\" class=\"oficial-site__link\" target=\"_blank\" onmouseover=\"this.href=&quot;https://www.amd.com/en/products/cpu/amd-ryzen-5-3600&quot;;\">amd.com</a></td></tr><tr valign=\"top\"><td class=\"op1\" width=\"49%\"><span><span class=\"cmp-gr-name\">Дата добавления на E-Katalog</span></span></td><td class=\"op3\" title=\"\" width=\"51%\">май 2019</td></tr><tr valign=\"top\"><td class=\"op1\" width=\"49%\"><span><span class=\"cmp-gr-name\">Маркировка производителя</span></span></td><td class=\"op3 ff-roboto\" width=\"51%\"><div class=\"ib\">100-100000031BOX</div><br></td></tr></tbody></table></td>");
        Map<String, String> specificationsMap = specificationsParser.parseProcessorSpecifications(doc);
        final String socket = specificationsMap.get("socket");
        final String tdp = specificationsMap.get("tdp");
        assertEquals("AMD AM4", socket);
        assertEquals("65", tdp);
    }
}
